<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Drop Parcel into <%= locker.lockerId %> / <%= compartment.compartmentId %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background: #f8f9fa; padding: 30px; }
    .card { border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.06); }
    .disabled-row { opacity: 0.45; }
    .size-tag { font-weight: 600; }
    .small { font-size: 0.9rem; padding: 2px 6px; border-radius: 6px; background: #eee; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card p-4 mb-4">
      <h4>Drop parcel into Locker <strong><%= locker.lockerId %></strong> â€” Compartment <strong><%= compartment.compartmentId %></strong></h4>
      <p>Compartment size: <span class="size-tag"><%= compartment.size !== undefined ? compartment.size : "unknown" %></span></p>
    </div>

    <div class="card p-3">
      <h5>Your parcels</h5>
      <% if (!parcels || parcels.length === 0) { %>
        <p class="text-muted">No parcels available for drop.</p>
      <% } else { %>
        <div class="list-group">
          <% parcels.forEach(function(p) { 
               // compute compatibility on server side too; but show hint in UI
               let compSize = compartment.size;
               let parcelSize = p.size;
               let sizeOk = true;
               if (compSize !== undefined && parcelSize !== undefined) {
                 if (!isNaN(Number(compSize)) && !isNaN(Number(parcelSize))) {
                   sizeOk = Number(parcelSize) <= Number(compSize);
                 } else {
                   sizeOk = String(compSize).toLowerCase() === String(parcelSize).toLowerCase();
                 }
               }
          %>
            <div class="list-group-item d-flex justify-content-between align-items-center <%= sizeOk ? '' : 'disabled-row' %>">
              <div>
                <div><strong>Parcel ID:</strong> <%= p._id %></div>
                <div><strong>Receiver:</strong> <%= p.receiverPhone %></div>
                <div><strong>Status:</strong> <%= p.status %></div>
                <div><strong>Size:</strong> <span class="small"><%= p.size !== undefined ? p.size : 'unknown' %></span></div>
                <div class="text-muted small">Created: <%= p.createdAt ? p.createdAt.toLocaleString() : '-' %></div>
              </div>

              <div>
                <% if (sizeOk) { %>
                  <form method="POST" action="/unlock/<%= locker.lockerId %>/<%= compartment.compartmentId %>/drop">
                    <input type="hidden" name="parcelId" value="<%= p._id %>" />
                    <button type="submit" class="btn btn-success">Drop this parcel</button>
                  </form>
                <% } else { %>
                  <button class="btn btn-secondary" disabled>Doesn't fit</button>
                <% } %>
              </div>    
            </div>
          <% }) %>
        </div>
      <% } %>
      <div class="mt-3 mb-3">    
        <a href="/mobileDashboard" class="btn btn-outline-primary">Book a parcel</a> 
        
      </div>
      <p> or try booking from the locker terminal</p>
    </div>
    
  </div>
  
</body>
</html>
